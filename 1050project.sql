CREATE TABLE DEPARTMENT(
    DEPARTMENTNO NUMBER(4) NOT NULL PRIMARY KEY,
    DEPARTMENTNAME VARCHAR2(25) NOT NULL,
    BOXNO VARCHAR2(50),
    OFFICEEXT CHAR(4)
);

CREATE TABLE VEHICLE(
    VEHICLEID VARCHAR2(6) PRIMARY KEY NOT NULL,
    PLATENO CHAR(7) UNIQUE,
    CARMAKE VARCHAR2(25),
    CARMODEL VARCHAR2(25),
    YEAROFMANUFACTURE CHAR(4)
);

CREATE TABLE EMPLOYEE(
    EMPLOYEEID NUMBER(8) NOT NULL PRIMARY KEY,
    EMPLOYEENAME VARCHAR2(50) NOT NULL,
    HOBBIES VARCHAR2(100),
    SALARY NUMBER(8,2),
    OVERTIMEPAY NUMBER(8,2),
    CERTIFICATION VARCHAR2(50),
    DEPARTMENTNO NUMBER(4) NOT NULL,
    VEHICLEID VARCHAR2(6) NOT NULL,
    CONSTRAINT FK_VEHICLEID FOREIGN KEY(VEHICLEID) REFERENCES VEHICLE(VEHICLEID) ON DELETE SET NULL
);

CREATE TABLE DEPENDENTS(
    DEPENDENTNO NUMBER(6) PRIMARY KEY,
    EMP_NO NUMBER(8) NOT NULL,
    LASTNAME VARCHAR2(30) NOT NULL,
    FIRSTNAME VARCHAR2(30) NOT NULL,
    FOREIGN KEY (EMP_NO)REFERENCES EMPLOYEE(EMPLOYEEID) ON DELETE CASCADE
);

CREATE TABLE TRAINING(
    TRAININGNO NUMBER(4) PRIMARY KEY,
    TRAININGDATE DATE,
    TRAININGTYPE VARCHAR(50)
);

CREATE TABLE RESULTS(
    EMPLOYEEID NUMBER(8) NOT NULL,
    TRAININGNO NUMBER(8) NOT NULL,
    TRAININGSTATUS VARCHAR2(25) CONSTRAINT CHKRESULTS CHECK(TRAININGSTATUS IN ('COMPLETED','NOT COMPLETED')),
    CONSTRAINT PK_RESULTS PRIMARY KEY(EMPLOYEEID,TRAININGNO),
    FOREIGN KEY (EMPLOYEEID) REFERENCES EMPLOYEE(EMPLOYEEID) ON DELETE CASCADE,
    FOREIGN KEY (TRAININGNO) REFERENCES TRAINING(TRAININGNO) ON DELETE CASCADE
);

CREATE TABLE OFFICELOCATIONS(
    OFFICENO NUMBER(4) PRIMARY KEY,
    OFFICELOCATION VARCHAR2(25),
);


CREATE TABLE SALESREPRESENTATIVES(
    REPIDNUMBER NUMBER(5) PRIMARY KEY NOT NULL,
    SALESREPNAME VARCHAR2(50),
    COUNTRYRESIDENCE VARCHAR2(50)
);

CREATE TABLE OFFREPJUNCTION(
    OFFICENO NUMBER(4) NOT NULL,
    REPIDNUMBER NUMBER(5) NOT NULL,
    CONSTRAINT PK_OFFREP PRIMARY KEY(OFFICENO, REPIDNUMBER),
    FOREIGN KEY (OFFICENO) REFERENCES OFFICELOCATIONS(OFFICENO) ON DELETE CASCADE,
    FOREIGN KEY (REPIDNUMBER) REFERENCES SALESREPRESENTATIVES(REPIDNUMBER) ON DELETE CASCADE
);

CREATE TABLE NEXTOFKIN(
    NEXTOFKINNO NUMBER(3) NOT NULL PRIMARY KEY,
    REPIDNUMBER NUMBER(5) NOT NULL,
    GENDER CHAR(1),
    FIRSTNAME VARCHAR2(25),
    LASTNAME VARCHAR2(25),
    FOREIGN KEY (REPIDNUMBER) REFERENCES SALESREPRESENTATIVES(REPIDNUMBER) ON DELETE CASCADE
);

CREATE SEQUENCE DEPARTMENT_SEQ START WITH 2000 INCREMENT BY 5;

CREATE SEQUENCE EMPLOYEE_SEQ START WITH 85550001 INCREMENT BY 1;
 
INSERT INTO DEPARTMENT VALUES (DEPARTMENT_SEQ.NEXTVAL, 'ACCOUNTING', '4301-00100', '2200');

INSERT INTO DEPARTMENT VALUES (DEPARTMENT_SEQ.NEXTVAL, 'FINANCE', '2534-00100', '2500');

INSERT INTO DEPARTMENT VALUES (DEPARTMENT_SEQ.NEXTVAL, 'HR', '8931-00100', '2450');

INSERT INTO DEPARTMENT VALUES (DEPARTMENT_SEQ.NEXTVAL, 'IT', '6723-00100', '2000');

INSERT INTO VEHICLE VALUES ('VGK005', 'KDK100A', 'TOYOTA', 'LAND CRUISER', '2011');

INSERT INTO VEHICLE VALUES ('VGK010', 'KDA210H', 'TOYOTA', 'PROBOX', '2015');

INSERT INTO VEHICLE VALUES ('VGK011', 'KCZ221E', 'MAZDA', 'DEMIO', '2012');

INSERT INTO VEHICLE VALUES ('VGK125', 'KBE231T', 'SUBARU', 'FORESTER', '2012');

INSERT INTO EMPLOYEE VALUES (EMPLOYEE_SEQ.NEXTVAL,'Mary Kibe', 'Swimming, Knitting', 90000.00, 0.00, 'TEAM BUILDING','2000','VGK125');

INSERT INTO EMPLOYEE VALUES (EMPLOYEE_SEQ.NEXTVAL,'Alan Guantai', 'Basketball', 66000.00, 22000.00, 'Cyber Skills','2010','VGK010');

INSERT INTO EMPLOYEE VALUES (EMPLOYEE_SEQ.NEXTVAL,'Mambo Mbaya', 'Yoga', 120000.00, 2000.00, 'CPA 4','2005','VGK005');

INSERT INTO EMPLOYEE VALUES (EMPLOYEE_SEQ.NEXTVAL,'Chizi Flani', 'Pottery, Baking', 100000.00, 00.00, 'CPA 4','2005','VGK011');


INSERT INTO DEPENDENTS VALUES(56001, 85550001,'Kuria', 'Moses');

INSERT INTO DEPENDENTS VALUES(56002, 85550001,'Kiprop', 'Meshack');

INSERT INTO DEPENDENTS VALUES(58001, 85550003,'Musau', 'Geoffrey');

INSERT INTO DEPENDENTS VALUES(58002, 85550003,'Omondi', 'Eugene');
                                                                                                                                                                                                                                                                                                                                                                                                                      
INSERT INTO TRAINING VALUES(9001, '12-APR-2020','CPA 4');

INSERT INTO TRAINING VALUES(9003, '16-OCT-2021','TEAM BUILDING');

INSERT INTO TRAINING VALUES(9010, '17-AUG-2022','CYBER SKILLS');

INSERT INTO RESULTS VALUES (85550003, 9001,'COMPLETED');

INSERT INTO RESULTS VALUES (85550001, 9001,'NOT COMPLETED');

INSERT INTO RESULTS VALUES (85550002, 9010,'COMPLETED');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
INSERT INTO SALESREPRESENTATIVES VALUES(33001, 'BRIANA NZIVU', 'ENGLAND');

INSERT INTO SALESREPRESENTATIVES VALUES(33002, 'LYDIA BARAKA', 'AUSTRALIA');

INSERT INTO SALESREPRESENTATIVES VALUES(33003, 'JUMA HASSAN', 'HOLLAND');
                                                                                                                                                                                                                                                                                                                                                                                                                                            
INSERT INTO OFFICELOCATIONS VALUES(7520, 'LONDON',350000.00);

INSERT INTO OFFICELOCATIONS VALUES(7521, 'MELBOURNE',150000.00);

INSERT INTO OFFICELOCATIONS VALUES(7530, 'AMSTERDAM',30000.00);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
INSERT INTO OFFREPJUNCTION VALUES(7520,33001);

INSERT INTO OFFREPJUNCTION VALUES(7521,33002);

INSERT INTO OFFREPJUNCTION VALUES(7530,33003);

INSERT INTO NEXTOFKIN VALUES (301, 33001,'M', 'BRIAN', 'NGUI');

INSERT INTO NEXTOFKIN VALUES (302, 33002,'M', 'EMMANUEL', 'LITI');

INSERT INTO NEXTOFKIN VALUES (303, 33003,'F', 'MARIA', 'HASSAN');
                                                                                                                                                                                                                                       
CREATE VIEW LONDONOFFICE AS SELECT * FROM OFFICELOCATIONS WHERE OFFICELOCATION = 'LONDON';

CREATE OR REPLACE VIEW TOYOTAFLEET AS SELECT * FROM VEHICLE WHERE CARMAKE = 'TOYOTA' WITH CHECK OPTION;
                                                                                                                                                                                                                                  
CREATE OR REPLACE PUBLIC SYNONYM SALESREP FOR  SALESREPRESENTATIVES;

CREATE OR REPLACE PUBLIC SYNONYM OVERSEASOFFICES FOR  OFFICELOCATIONS;


CREATE PROCEDURE NEWOFFICELOC(OFFNO NUMBER, LOC VARCHAR2, RENT NUMBER)
  IS
  BEGIN
  INSERT INTO OFFICELOCATIONS VALUES(OFFNO, LOC, RENT);
  COMMIT;
  DBMS_OUTPUT.PUT_LINE('OFFICE LOCATIONS MODIFIED');
  END;
  /

EXEC NEWOFFICELOC(7531, 'NEW YORK', 180000.00);
                                                                                                                                                                                                                                                           
CREATE PROCEDURE DELETE_EMP
  AS
  BEGIN
  DELETE FROM EMPLOYEE WHERE EMP_NO =85550004;
  DBMS_OUTPUT.PUT_LINE('EMPLOYEE REMOVED!');
  END;
  /

CREATE OR REPLACE TRIGGER emp_alert_trig
  BEFORE INSERT ON EMPLOYEE
  BEGIN
  DBMS_OUTPUT.PUT_LINE('New employees are about to be added');
  END;
  /

INSERT INTO EMPLOYEE VALUES (EMPLOYEE_SEQ.NEXTVAL,'Chizi Flani', 'Pottery, Baking', 100000.00, 00.00, 'CPA 4','2005','VGK011');

CREATE OR REPLACE TRIGGER OVERTIMEPAY_TRIG
  BEFORE UPDATE OR INSERT ON EMPLOYEE
  FOR EACH ROW WHEN (NEW.OVERTIMEPAY<500.00)
  DECLARE
  OVERTIMEPAY_TOO_LOW EXCEPTION;
  BEGIN
  RAISE OVERTIMEPAY_TOO_LOW;
  EXCEPTION
  WHEN OVERTIMEPAY_TOO_LOW THEN
  RAISE_APPLICATION_ERROR (-20001, OVERTIME PAY TOO LOW FOR INSERTION);

DROP TRIGGER OVERTIMEPAY_TRIG;

Trigger dropped.

SQL> CREATE OR REPLACE TRIGGER OVERTIMEPAY_TRIG
  BEFORE UPDATE OR INSERT ON EMPLOYEE
  FOR EACH ROW WHEN (NEW.OVERTIMEPAY<500.00)
  DECLARE
  OVERTIMEPAY_TOO_LOW EXCEPTION;
  BEGIN
  RAISE OVERTIMEPAY_TOO_LOW;
  EXCEPTION
  WHEN OVERTIMEPAY_TOO_LOW THEN
  RAISE_APPLICATION_ERROR (-20001, 'OVERTIME PAY TOO LOW FOR INSERTION.');
  End;
  /

INSERT INTO VEHICLE VALUES ('VGK130', 'KBD231T', 'SUBARU', 'OUTBACK', '2012');

INSERT INTO EMPLOYEE VALUES (EMPLOYEE_SEQ.NEXTVAL,'Benson Ndora', 'Baking', 120000.00, 600.00, 'CPA 4','2005','VGK130');

CREATE INDEX EMP_IDX ON EMPLOYEE (EMPLOYEENAME);

CREATE INDEX EMPPAY_IDX ON EMPLOYEE (SALARY,OVERTIMEPAY);

CREATE INDEX TRAINING_IDX ON TRAINING (TRAININGDATE);

CREATE USER C##HR IDENTIFIED BY 123;

DROP USER C##HR;

GRANT ALL ON EMPLOYEE TO SYSTEM;

GRANT ALL ON VEHICLE TO SYSTEM;


CONNECT

CREATE USER C##HR
IDENTIFIED BY 123;

GRANT ALL ON C##JKRUTO.EMPLOYEE TO C##HR;

CONNECT

GRANT CREATE SESSION TO C##HR;